<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Vincent Durmont</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat"
      rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="/assets/css/vdurmont.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/assets/css/prism-hopscotch.css"
    />
  </head>
  <body>
    <div class="page">
      <h1 class="title"><a href="/">Vincent Durmont</a></h1>
      
<p><a href="/">&laquo; Back</a></p>

<p class="blog-date">May 29, 2023</p>
<h1 class="blog-title">GraphQL â€” Default to optional fields</h1>
<p><em>I write a series of posts about GraphQL API design. Find the full list <a href="/posts/2023-03-11-graphql-api-design">here</a>!</em></p>
<h1>TL;DR</h1>
<p>Prefer to expose fields that are optional instead of required. In case of an error, GraphQL will only nullify a branch of the data tree but the rest of the data will still render properly.</p>
<h1>The longer explanation</h1>
<p>Error handling in GraphQL works as follows:</p>
<ul>
<li>If a field is required and generates an error, the whole object will be nullified.</li>
<li>If a field is optional and generates an error, only that specific branch of the tree will be nullified.</li>
</ul>
<p>This means that using optional fields will make it easier for your clients to gracefully handle errors and maybe display partial data. Using required fields will prevent them from displaying anything.</p>
<p>GraphQL APIs are usually designed to be used by multiple types of clients and I usually think it's best to stay flexible and let each of them decide what they can and cannot display.</p>
<h1>Example</h1>
<h2>With required fields</h2>
<p>Imagine the following schema:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">transaction</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">Transaction</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> <span class="token class-name">Transaction</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><br>  <span class="token attr-name">amount</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span><br>  <span class="token attr-name">sender</span><span class="token punctuation">:</span> <span class="token class-name">Person</span><span class="token operator">!</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><br>  <span class="token attr-name">avatar_url</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><br><span class="token punctuation">}</span></code></pre>
<p>We could easily imagine a client that would display the details of a transaction. They may issue the following query:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">MyAwesomeQuery</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query">transaction</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">id</span><br>    <span class="token property">amount</span><br>    <span class="token object">sender</span> <span class="token punctuation">{</span><br>      <span class="token property">name</span><br>      <span class="token property">avatar_url</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>And their frontend may look a bit like this:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">TransactionDetails</span><span class="token punctuation">(</span>props<span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> transaction <span class="token operator">=</span> props<span class="token punctuation">.</span>transaction<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>transaction<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>Cannot find the transaction<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>div<span class="token operator">></span><br>      <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>transaction<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span>Amount<span class="token operator">:</span> <span class="token constant">USD</span> <span class="token punctuation">{</span>transaction<span class="token punctuation">.</span>amount<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span>The transaction was sent by <span class="token punctuation">{</span>transaction<span class="token punctuation">.</span>sender<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>      <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>transaction<span class="token punctuation">.</span>sender<span class="token punctuation">.</span>avatar_url<span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>Now, let's say that there is some issue when generating the <code>avatar_url</code> of the <code>sender</code> (maybe the CDN is down?). The JSON response will look like this:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"transaction"</span><span class="token operator">:</span> <span class="token null keyword">null</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"errors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span> <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"AvatarException"</span><span class="token punctuation">,</span> <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"Cannot generate the avatar URL."</span> <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>The <code>sender</code> object will not be generated at all since one of its required fields is missing. This means that the <code>transaction</code> itself won't generate because the <code>sender</code> field is missing. And the client displays the &quot;Cannot find the transaction.&quot; error message, which is a poor experience.</p>
<h2>With optional fields</h2>
<p>Now, let's rewrite this example with optional fields. The schema becomes:</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">Query</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">transaction</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name">Transaction</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> <span class="token class-name">Transaction</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><br>  <span class="token attr-name">amount</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span><br>  <span class="token attr-name">sender</span><span class="token punctuation">:</span> <span class="token class-name">Person</span><span class="token operator">!</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">type</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">name</span><span class="token punctuation">:</span> <span class="token scalar">String</span><span class="token operator">!</span><br>  <span class="token attr-name">avatar_url</span><span class="token punctuation">:</span> <span class="token scalar">String</span><br><span class="token punctuation">}</span></code></pre>
<p>The frontend can now handle partial data:</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">function</span> <span class="token function">TransactionDetails</span><span class="token punctuation">(</span>props<span class="token operator">:</span> Props<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> transaction <span class="token operator">=</span> props<span class="token punctuation">.</span>transaction<span class="token punctuation">;</span><br>  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>transaction<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token operator">&lt;</span>div<span class="token operator">></span>Cannot find the transaction<span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><br>  <span class="token keyword">return</span> <span class="token punctuation">(</span><br>    <span class="token operator">&lt;</span>div<span class="token operator">></span><br>      <span class="token operator">&lt;</span>h1<span class="token operator">></span><span class="token punctuation">{</span>transaction<span class="token punctuation">.</span>id<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span>Amount<span class="token operator">:</span> <span class="token constant">USD</span> <span class="token punctuation">{</span>transaction<span class="token punctuation">.</span>amount<span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>      <span class="token operator">&lt;</span>p<span class="token operator">></span>The transaction was sent by <span class="token punctuation">{</span>transaction<span class="token punctuation">.</span>sender<span class="token punctuation">.</span>name<span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">></span><br>      <span class="token operator">&lt;</span>img src<span class="token operator">=</span><span class="token punctuation">{</span>transaction<span class="token punctuation">.</span>sender<span class="token punctuation">.</span>avatar_url <span class="token operator">||</span> <span class="token constant">PLACEHOLDER_AVATAR_URL</span><span class="token punctuation">}</span> <span class="token operator">/</span><span class="token operator">></span><br>    <span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">></span><br>  <span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>If the avatar URL cannot be generated, the response will look like this:</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span><br>  <span class="token property">"data"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>    <span class="token property">"transaction"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token property">"id"</span><span class="token operator">:</span> <span class="token string">"1234567890"</span><span class="token punctuation">,</span><br>      <span class="token property">"amount"</span><span class="token operator">:</span> <span class="token number">42</span><span class="token punctuation">,</span><br>      <span class="token property">"sender"</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"Vincent"</span><span class="token punctuation">,</span><br>        <span class="token property">"avatar_url"</span><span class="token operator">:</span> <span class="token null keyword">null</span><br>      <span class="token punctuation">}</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token property">"errors"</span><span class="token operator">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span> <span class="token property">"key"</span><span class="token operator">:</span> <span class="token string">"AvatarException"</span><span class="token punctuation">,</span> <span class="token property">"message"</span><span class="token operator">:</span> <span class="token string">"Cannot generate the avatar URL."</span> <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre>
<p>The client can use a placeholder for the avatar URL and still display most of the information. Of course, we can take that logic further by making the <code>sender</code> field optional too, etc.</p>
<h1>When not to do it?</h1>
<p>As in every rule/advice, there are always exceptions. I usually make fields required when without them, the object doesn't really make &quot;sense&quot;. This is done on a case-by-case basis but here are some examples:</p>
<ul>
<li>A transaction without an <code>amount</code> might not make sense</li>
<li>A person without a <code>name</code> might not make sense</li>
<li>A lightning node without a <code>public_id_key</code> might not make sense</li>
<li>etc.</li>
</ul>
<p>Use your best judgement for the context of your application ðŸ˜‰</p>


    </div>
  </body>
</html>
