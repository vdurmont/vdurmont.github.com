<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Vincent Durmont</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat"
      rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="/assets/css/vdurmont.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/assets/css/prism-hopscotch.css"
    />
  </head>
  <body>
    <div class="page">
      <h1 class="title"><a href="/">Vincent Durmont</a></h1>
      
<p><a href="/">&laquo; Back</a></p>

<p class="blog-date">March 12, 2023</p>
<h1 class="blog-title">GraphQL â€” Use edges, not IDs</h1>
<p><em>I write a series of posts about GraphQL API design. Find the full list <a href="/posts/2023-03-11-graphql-api-design">here</a>!</em></p>
<h1>TL;DR</h1>
<p>Never expose a field with another entity ID, instead, you should expose an edge to that other entity and let the client crawl the graph.</p>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">type</span> <span class="token class-name">Transaction</span> <span class="token punctuation">{</span><br>  <span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><br>  <span class="token attr-name">amount</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span><br>  <span class="token attr-name">sender_id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span> <span class="token comment"># BAD!</span><br>  <span class="token attr-name">sender</span><span class="token punctuation">:</span> <span class="token class-name">User</span><span class="token operator">!</span> <span class="token comment"># GOOD!</span><br><span class="token punctuation">}</span></code></pre>
<h1>The longer explanation</h1>
<p>As its name indicates, GraphQL (Graph Query Language) is based on the idea that the client will find an entry point in the graph using one of the top-level query/mutation/subscription, and will then be able to crawl the graph and fetch the data it needs.</p>
<p>When you expose another entity's ID, you prevent the client from hoping the edge and fetching that other entity's data. You force the client to issue one or more additional HTTP requests for something that could have been done in a single one.</p>
<p>Remember that a core principle of GraphQL is that the server doesn't cater to the specific needs of each client, but instead exposes an API that provides access to the whole graph and lets each client decide what is right for them. So don't think about &quot;what does my client need today&quot; but &quot;how do I expose the whole graph in a consistent and structured way&quot;.</p>
<h1>Examples</h1>
<h2>Displaying the details of an entity</h2>
<p>Imagine that I am building a banking app and I want to display the details of a transaction I received.</p>
<p>If you were exposing IDs, you would have to first query the transaction details, then query the additional data from the sender. Below is a simple example in Python:</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">print_transaction_details</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span><br>  data <span class="token operator">=</span> <span class="token keyword">await</span> execute_bad_query<span class="token punctuation">(</span><span class="token punctuation">)</span><br>  sender_id <span class="token operator">=</span> data<span class="token punctuation">.</span>transaction<span class="token punctuation">.</span>sender_id<br>  sender_data <span class="token operator">=</span> <span class="token keyword">await</span> execute_sender_query<span class="token punctuation">(</span>variables<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span> sender_id<span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"You received </span><span class="token interpolation"><span class="token punctuation">{</span>data<span class="token punctuation">.</span>amount<span class="token punctuation">}</span></span><span class="token string"> USD from </span><span class="token interpolation"><span class="token punctuation">{</span>sender_data<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">."</span></span><span class="token punctuation">)</span></code></pre>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">BadQuery</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query">transaction</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">amount</span><br>    <span class="token property">sender_id</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">query</span> <span class="token definition-query function">SenderQuery</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query">user</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">name</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>When you expose an edge, it becomes much easier, you only have to execute a single query!</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">print_transaction_details</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span><br>  data <span class="token operator">=</span> <span class="token keyword">await</span> execute_good_query<span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"You received </span><span class="token interpolation"><span class="token punctuation">{</span>data<span class="token punctuation">.</span>amount<span class="token punctuation">}</span></span><span class="token string"> USD from </span><span class="token interpolation"><span class="token punctuation">{</span>data<span class="token punctuation">.</span>sender<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">."</span></span><span class="token punctuation">)</span></code></pre>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">GoodQuery</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query">transaction</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">amount</span><br>    <span class="token object">sender</span> <span class="token punctuation">{</span><br>      <span class="token property">name</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<h2>Displaying the details of an list of entities</h2>
<p>The example above was a very simple, with a single edge. But things could have been much worse. Imagine that you want to display a list of transactions now!</p>
<p>Without edges, you have to execute <code>n+1</code> requests (<code>n</code> being the number of transactions you decide to display).</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">print_transaction_details</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span><br>  data <span class="token operator">=</span> <span class="token keyword">await</span> execute_bad_query<span class="token punctuation">(</span>variables<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"number_of_transactions"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">for</span> transaction <span class="token keyword">in</span> data<span class="token punctuation">.</span>transactions<span class="token punctuation">:</span><br>    sender_id <span class="token operator">=</span> transaction<span class="token punctuation">.</span>sender_id<br>    sender_data <span class="token operator">=</span> <span class="token keyword">await</span> execute_sender_query<span class="token punctuation">(</span>variables<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"id"</span><span class="token punctuation">:</span> sender_id<span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"You received </span><span class="token interpolation"><span class="token punctuation">{</span>data<span class="token punctuation">.</span>amount<span class="token punctuation">}</span></span><span class="token string"> USD from </span><span class="token interpolation"><span class="token punctuation">{</span>sender_data<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">."</span></span><span class="token punctuation">)</span></code></pre>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">BadQuery</span><span class="token punctuation">(</span><span class="token variable">$number_of_transaction</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query">transactions</span><span class="token punctuation">(</span><span class="token property">first</span><span class="token operator">=</span><span class="token variable">$number_of_transaction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">amount</span><br>    <span class="token property">sender_id</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">query</span> <span class="token definition-query function">SenderQuery</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">:</span> <span class="token scalar">ID</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query">user</span><span class="token punctuation">(</span><span class="token attr-name">id</span><span class="token punctuation">:</span> <span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">name</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>But still a single transaction if you're using edges!</p>
<pre class="language-python"><code class="language-python"><span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">print_transaction_details</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">></span> <span class="token boolean">None</span><span class="token punctuation">:</span><br>  data <span class="token operator">=</span> <span class="token keyword">await</span> execute_good_query<span class="token punctuation">(</span>variables<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"number_of_transactions"</span><span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token keyword">for</span> transaction <span class="token keyword">in</span> data<span class="token punctuation">.</span>transactions<span class="token punctuation">:</span><br>    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"You received </span><span class="token interpolation"><span class="token punctuation">{</span>transaction<span class="token punctuation">.</span>amount<span class="token punctuation">}</span></span><span class="token string"> USD from </span><span class="token interpolation"><span class="token punctuation">{</span>transaction<span class="token punctuation">.</span>sender<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">."</span></span><span class="token punctuation">)</span></code></pre>
<pre class="language-graphql"><code class="language-graphql"><span class="token keyword">query</span> <span class="token definition-query function">GoodQuery</span><span class="token punctuation">(</span><span class="token variable">$number_of_transaction</span><span class="token punctuation">:</span> <span class="token scalar">Int</span><span class="token operator">!</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token property-query">transactions</span><span class="token punctuation">(</span><span class="token property">first</span><span class="token operator">=</span><span class="token variable">$number_of_transaction</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token property">amount</span><br>    <span class="token object">sender</span> <span class="token punctuation">{</span><br>      <span class="token property">name</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>


    </div>
  </body>
</html>
