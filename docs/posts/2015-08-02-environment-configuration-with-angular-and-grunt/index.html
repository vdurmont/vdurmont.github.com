<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Vincent Durmont</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat"
      rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="/assets/css/vdurmont.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/assets/css/prism-hopscotch.css"
    />
  </head>
  <body>
    <div class="page">
      <h1 class="title"><a href="/">Vincent Durmont</a></h1>
      
<p><a href="/">&laquo; Back</a></p>

<p class="blog-date">August 2, 2015</p>
<h1 class="blog-title">Environment configuration with Angular and Grunt</h1>
<p>When I write an Angular application, I usually create a <em>constant</em> <a href="https://docs.angularjs.org/api/ng/type/angular.Module">module</a> to store my environment variables:</p>
<pre class="language-js"><code class="language-js">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">"myApp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token string">"Config"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  <span class="token constant">API_URL</span><span class="token operator">:</span> <span class="token string">"http://localhost:8080/"</span><span class="token punctuation">,</span><br>  <span class="token constant">GITHUB_CLIENT_ID</span><span class="token operator">:</span> <span class="token string">"xxxxxxxxxxxxxxx"</span><span class="token punctuation">,</span><br>  <span class="token operator">...</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>I can then inject my config anywhere in the application and use those variables.</p>
<p>These variables can change based on where the app is deployed and I needed a simple way to define several environments. Since I use <a href="http://gruntjs.com/">Grunt</a> to build, test and deploy my javascript apps, I wanted to find something that would be seamlessly integrated in my build process.</p>
<!--more-->
<p>In this post I will give you an easy way to achieve this, using <a href="https://github.com/outaTiME/grunt-replace">grunt-replace</a>.</p>
<h2>Angular constant module</h2>
<p>Modify the values by putting <code>@@</code> followed by the key name.</p>
<pre class="language-js"><code class="language-js">angular<span class="token punctuation">.</span><span class="token function">module</span><span class="token punctuation">(</span><span class="token string">"myApp"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">constant</span><span class="token punctuation">(</span><span class="token string">"Config"</span><span class="token punctuation">,</span> <span class="token punctuation">{</span><br>  <span class="token constant">API_URL</span><span class="token operator">:</span> <span class="token string">"@@API_URL"</span><span class="token punctuation">,</span><br>  <span class="token constant">GITHUB_CLIENT_ID</span><span class="token operator">:</span> <span class="token string">"@@GITHUB_CLIENT_ID"</span><span class="token punctuation">,</span><br>  <span class="token operator">...</span><br><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h2>Create a config file for each environment</h2>
<p>For example, if I have a <code>development</code> and a <code>production</code> environment:</p>
<p><strong>./src/config/development.json</strong></p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  <span class="token constant">API_URL</span><span class="token operator">:</span> <span class="token string">"http://localhost:8080/"</span><span class="token punctuation">,</span><br>  <span class="token constant">GITHUB_CLIENT_ID</span><span class="token operator">:</span> <span class="token string">"xxxxxxxxxxxxxxx"</span><span class="token punctuation">,</span><br>  <span class="token operator">...</span><br><span class="token punctuation">}</span></code></pre>
<p><strong>./src/config/production.json</strong></p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br>  <span class="token constant">API_URL</span><span class="token operator">:</span> <span class="token string">"http://api.myapp.com/"</span><span class="token punctuation">,</span><br>  <span class="token constant">GITHUB_CLIENT_ID</span><span class="token operator">:</span> <span class="token string">"yyyyyyyyyyyyyyy"</span><span class="token punctuation">,</span><br>  <span class="token operator">...</span><br><span class="token punctuation">}</span></code></pre>
<h2>Add <code>grunt-replace</code> to your Gruntfile</h2>
<p>Here are the interesting parts of the <code>Gruntfile.js</code>:</p>
<pre class="language-js"><code class="language-js">module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">grunt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token comment">// Method used to generate a config environment</span><br>  <span class="token keyword">var</span> <span class="token function-variable function">getConfig</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">configName</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">return</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>        <span class="token literal-property property">patterns</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>          <span class="token literal-property property">json</span><span class="token operator">:</span> grunt<span class="token punctuation">.</span>file<span class="token punctuation">.</span><span class="token function">readJSON</span><span class="token punctuation">(</span><span class="token string">"./src/config/"</span> <span class="token operator">+</span> configName <span class="token operator">+</span> <span class="token string">".json"</span><span class="token punctuation">)</span><br>        <span class="token punctuation">}</span><span class="token punctuation">]</span><br>      <span class="token punctuation">}</span><span class="token punctuation">,</span><br>      <span class="token literal-property property">files</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><br>        <span class="token literal-property property">expand</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">flatten</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><br>        <span class="token comment">// Here "dist/js/app.min.js" is a minified script with my whole application</span><br>        <span class="token literal-property property">src</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"dist/js/app.min.js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>        <span class="token literal-property property">dest</span><span class="token operator">:</span> <span class="token string">"dist/js/"</span><br>      <span class="token punctuation">}</span><span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><br>  grunt<span class="token punctuation">.</span><span class="token function">initConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span><br>    <span class="token comment">// Config...</span><br><br>    <span class="token comment">// Replace the configuration according to the profile</span><br>    <span class="token literal-property property">replace</span><span class="token operator">:</span> <span class="token punctuation">{</span><br>      <span class="token literal-property property">development</span><span class="token operator">:</span> <span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token string">"development"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>      <span class="token literal-property property">production</span><span class="token operator">:</span> <span class="token function">getConfig</span><span class="token punctuation">(</span><span class="token string">"production"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">}</span><span class="token punctuation">,</span><br><br>    <span class="token comment">// Config...</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br>  <span class="token comment">// Load the NPM tasks</span><br>  grunt<span class="token punctuation">.</span><span class="token function">loadNpmTasks</span><span class="token punctuation">(</span><span class="token string">"grunt-replace"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token comment">// ...</span><br><br>  <span class="token comment">// Register your tasks</span><br>  grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">,</span> <span class="token string">"replace:development"</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  grunt<span class="token punctuation">.</span><span class="token function">registerTask</span><span class="token punctuation">(</span><span class="token string">"production"</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token operator">...</span><span class="token punctuation">,</span> <span class="token string">"replace:production"</span><span class="token punctuation">,</span> <span class="token operator">...</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<h2>Run!</h2>
<p>When you will run <code>grunt</code>, the <code>replace:development</code> task will be used and all your keys will be replaced by the values in <code>development.json</code>. The same will happen for <code>replace:production</code> or any other profile you will have defined.</p>


    </div>
  </body>
</html>
