<!DOCTYPE html>

<html lang="en">
  <head>
    <title>Vincent Durmont</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://fonts.googleapis.com/css?family=Montserrat"
      rel="stylesheet"
    />
    <link rel="stylesheet" type="text/css" href="/assets/css/vdurmont.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="/assets/css/prism-hopscotch.css"
    />
  </head>
  <body>
    <div class="page">
      <h1 class="title"><a href="/">Vincent Durmont</a></h1>
      
<p><a href="/">&laquo; Back</a></p>

<p class="blog-date">January 16, 2014</p>
<h1 class="blog-title">Java8 â€“ Introduction to Lambdas and Stream API</h1>
<p>Yesterday, I attended an awesome conference at the <a href="http://toulousejug.org/">Toulouse JUG [FR]</a> (an association of Java-lovers in the city of Toulouse, see <a href="https://www.java.net/jugs/java-user-groups">Java User Group</a>).</p>
<p>The talk was given by <a href="http://twitter.com/josepaumard">Jose Paumard</a>. The subject was Java 8 and more precisely, the Lambdas, the Stream API and the impact on the use of the Collection API. Here are the main points I remembered from this talk.</p>
<!--more-->
<p><img src="/assets/blog/20140116/java8-takeout-from-toulousejug-photo.jpg" alt="Toulouse JUG"></p>
<p>You can find the whole presentation in french <a href="http://fr.slideshare.net/jpaumard/jdk-8-lambdas-streams-collectos-bretagne-tour">here</a>.</p>
<h1>Lambdas</h1>
<p>The lambdas are a clear an concise way to represent a mono-method interface. Our code will be shorter and easier to read so we will save time and money! Let's take a simple example. I have a <code>Vehicle</code> which has a number of wheels.</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">{</span><br>	<span class="token keyword">private</span> <span class="token class-name">Integer</span> numWheels<span class="token punctuation">;</span><br><br>	<span class="token comment">// Constructor, Getters &amp; Setters</span><br><span class="token punctuation">}</span></code></pre>
<p>I want to sort a list of vehicles and write a comparator:</p>
<pre class="language-java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Vehicle</span><span class="token punctuation">></span></span> vehicles <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><br><br><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><br>	vehicles<span class="token punctuation">,</span><br>	<span class="token keyword">new</span> <span class="token class-name">Comparator</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Vehicle</span><span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		<span class="token annotation punctuation">@Override</span><br>		<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compare</span><span class="token punctuation">(</span><span class="token class-name">Vehicle</span> v1<span class="token punctuation">,</span> <span class="token class-name">Vehicle</span> v2<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>			<span class="token keyword">return</span> v1<span class="token punctuation">.</span><span class="token function">getNumWheels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o2<span class="token punctuation">.</span><span class="token function">getNumWheels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>		<span class="token punctuation">}</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>It works but it's a lot of code for a small business logic... Here is how it can be written with lambdas:</p>
<pre class="language-java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Vehicle</span><span class="token punctuation">></span></span> vehicles <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><br><br><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><br>	vehicles<span class="token punctuation">,</span><br>	<span class="token punctuation">(</span><span class="token class-name">Vehicle</span> v1<span class="token punctuation">,</span> <span class="token class-name">Vehicle</span> v2<span class="token punctuation">)</span> <span class="token operator">-></span> v1<span class="token punctuation">.</span><span class="token function">getgetNumWheels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o2<span class="token punctuation">.</span><span class="token function">getNumWheels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token comment">// Or even shorter:</span><br><br><span class="token class-name">Collections</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span><br>	vehicles<span class="token punctuation">,</span><br>	v1<span class="token punctuation">,</span> v2 <span class="token operator">-></span> v1<span class="token punctuation">.</span><span class="token function">getgetNumWheels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>o2<span class="token punctuation">.</span><span class="token function">getNumWheels</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>It is shorter, as understandable as the Java 7 version and more readable.</p>
<h1>Streams</h1>
<p>If you program in Java, you make at least a daily use of the <code>Collection API</code> which contains the lists, the sets, the maps and all their implementations.</p>
<p>With the brand new <strong>Stream API</strong>, we will be able to change the way we usually go throught Collections in order to simplify the code, <strong>parallelize</strong> our algorithms and adapt to other data sources (sockets, databases, etc.). Let's take an example.</p>
<p>We have a list of <code>Vehicle</code>. Each <code>Vehicle</code> can transport a number of passengers and has a number of wheels.</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Vehicle</span> <span class="token punctuation">{</span><br>	<span class="token keyword">private</span> <span class="token class-name">Integer</span> numPassengers<span class="token punctuation">;</span><br>	<span class="token keyword">private</span> <span class="token class-name">Integer</span> numWheels<span class="token punctuation">;</span><br><br>	<span class="token comment">// Constructor, Getters &amp; Setters</span><br><span class="token punctuation">}</span></code></pre>
<p>We want to get the sum of the passengers that we can transport with the vehicles which have at least 1 wheel. The classic method would be:</p>
<pre class="language-java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Vehicle</span><span class="token punctuation">></span></span> vehicles <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span><br><span class="token keyword">int</span> sum <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><br><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Vehicle</span> vehicle <span class="token operator">:</span> vehicles<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>	<span class="token keyword">if</span> <span class="token punctuation">(</span>vehicle<span class="token punctuation">.</span><span class="token function">getNumWheels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>		sum <span class="token operator">+=</span> vehicle<span class="token punctuation">.</span><span class="token function">getNumPassengers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>	<span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre>
<p>But we can do better! This process can be modelized with the <a href="http://en.wikipedia.org/wiki/MapReduce">Map-Filter-Reduce pattern</a>.</p>
<p>The <code>Filter</code> will determine if the <code>Vehicle</code> should be excluded or not, the <code>Mapper</code> will extract from a <code>Vehicle</code> its number of passenger (an <code>Integer</code>) and the <code>Reducer</code> will perform the sum (important: <code>Red(Red(a, b), c) = Red(a, Red(b, c))</code>, this will enable us to crawl our collection iteratively).</p>
<p>Let's write it with interfaces:</p>
<pre class="language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Mapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">K</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span><br>	<span class="token keyword">public</span> <span class="token class-name">K</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Filter</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span><br>	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">T</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Reducer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">K</span><span class="token punctuation">></span></span> <span class="token punctuation">{</span><br>	<span class="token keyword">public</span> <span class="token class-name">K</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">K</span> t1<span class="token punctuation">,</span> <span class="token class-name">K</span> t2<span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>And implement our example with the Stream API:</p>
<pre class="language-java"><code class="language-java"><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Vehicle</span><span class="token punctuation">></span></span> vehicles <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span> <span class="token comment">// Not null and not empty :)</span><br><br><span class="token class-name">Integer</span> sum <span class="token operator">=</span><br>vehicles<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// We create a stream on the collection</span><br>	<span class="token comment">// Only keep when 1 wheel or more</span><br>		<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>v <span class="token operator">-></span> v<span class="token punctuation">.</span><span class="token function">getNumWheels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><br>	 <span class="token comment">// Retrieve number of passengers</span><br>		<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>v <span class="token operator">-></span> v<span class="token punctuation">.</span><span class="token function">getNumPassengers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>	<span class="token comment">// We add the passengers of each couple of vehicles</span><br>		<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2 <span class="token operator">-></span> v1<span class="token punctuation">.</span><span class="token function">getNumPassengers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> v2<span class="token punctuation">.</span><span class="token function">getNumPassengers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>It is WAAAAY more elegant than our loop and it has an enormous advantage: the Java 7 example tells exactly to the compiler <em>how</em> the algorithm should be executed. Here, in Java 8, I only specify <em>what</em> I want to do and the compiler is free to implement it in its own way. By the way, the last line could be replaced by a built-in method: <code>.sum()</code> :)</p>
<p>With a <code>Reducer</code> which respects the previous formula (which is associative and commutative), we can go through our streams in any order... so we can parallelize our code!</p>
<pre class="language-java"><code class="language-java">vehicles<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 			<span class="token comment">// The JVM handles the rest!</span><br>	<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>v <span class="token operator">-></span> v<span class="token punctuation">.</span><span class="token function">getNumWheels</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><br>	<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>v <span class="token operator">-></span> v<span class="token punctuation">.</span><span class="token function">getNumPassengers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>	<span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>v1<span class="token punctuation">,</span> v2 <span class="token operator">-></span> v1<span class="token punctuation">.</span><span class="token function">getNumPassengers</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> v2<span class="token punctuation">.</span><span class="token function">getNumPassengers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Simple, isn't it?</p>
<p>There are a lot of operation for each category which are already included in the JDK, for example: <code>collect</code> which retrieve the results in a collection, <code>sum</code>, <code>min</code>, <code>max</code>, etc.</p>
<h1>Conclusion</h1>
<p>During the conference, we talked about a lot of other things such as performance, contention points in the parallelization and Jose gave us lots of interesting examples. I think there is a lot to learn in order to master Java 8 but the challenge seems exciting!</p>
<p>It is the biggest modification of the way we handle the collections since the creation of the Collection API 15 years ago so I expect a lot of bugs, training and hard work to handle this properly :)</p>
<p>I will soon write new posts on Java 8 since there are a lot of subjects to talk about: default implementations in interfaces (multiple inheritance?), other formats of lambda expressions, etc.</p>
<p>Did you already try the Java 8 beta?</p>


    </div>
  </body>
</html>
